<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аутентификация</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-user-shield"></i> Система аутентификации</h1>
            <div class="auth-status" id="authStatus">
                Не авторизован
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="auth">Авторизация</button>
            <button class="tab" data-tab="register">Регистрация</button>
            <button class="tab" data-tab="recover">Восстановление</button>
            <button class="tab" data-tab="tokens">Токены</button>
        </div>

        <!-- Авторизация -->
        <div class="tab-content active" id="authTab">
            <div class="form-step active" id="authStep1">
                <h2><i class="fas fa-sign-in-alt"></i> Вход в систему</h2>
                <form id="authForm">
                    <div class="form-group">
                        <label for="authEmail">Email:</label>
                        <input type="email" id="authEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="authPassword">Пароль:</label>
                        <div class="password-input">
                            <input type="password" id="authPassword" required>
                            <button type="button" class="toggle-password" data-target="authPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Войти
                    </button>
                </form>
            </div>

            <div class="form-step" id="authStep2">
                <h2><i class="fas fa-envelope"></i> Подтверждение входа</h2>
                <p>На вашу почту отправлен код подтверждения</p>
                <form id="authCodeForm">
                    <div class="form-group">
                        <label for="authCode">Код из письма:</label>
                        <input type="text" id="authCode" maxlength="6" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-check"></i> Подтвердить
                    </button>
                    <button type="button" class="btn-secondary" id="backToAuth">
                        <i class="fas fa-arrow-left"></i> Назад
                    </button>
                </form>
            </div>
        </div>

        <!-- Регистрация -->
        <div class="tab-content" id="registerTab">
            <div class="form-step active" id="registerStep1">
                <h2><i class="fas fa-user-plus"></i> Регистрация</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerEmail">Email:</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Пароль:</label>
                        <div class="password-input">
                            <input type="password" id="registerPassword" required>
                            <button type="button" class="toggle-password" data-target="registerPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="password-rules">
                            <p>Пароль должен содержать:</p>
                            <ul>
                                <li id="rule-length">✓ Минимум 8 символов</li>
                                <li id="rule-uppercase">✓ Заглавную букву</li>
                                <li id="rule-lowercase">✓ Строчную букву</li>
                                <li id="rule-special">✓ Специальный символ</li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">Подтвердите пароль:</label>
                        <div class="password-input">
                            <input type="password" id="registerConfirmPassword" required>
                            <button type="button" class="toggle-password" data-target="registerConfirmPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="password-match" id="passwordMatch">
                            Пароли совпадают
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-user-plus"></i> Зарегистрироваться
                    </button>
                </form>
            </div>

            <div class="form-step" id="registerStep2">
                <h2><i class="fas fa-envelope"></i> Подтверждение регистрации</h2>
                <p>На вашу почту отправлен код подтверждения</p>
                <form id="registerCodeForm">
                    <div class="form-group">
                        <label for="registerCode">Код из письма:</label>
                        <input type="text" id="registerCode" maxlength="6" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-check"></i> Подтвердить
                    </button>
                    <button type="button" class="btn-secondary" id="backToRegister">
                        <i class="fas fa-arrow-left"></i> Назад
                    </button>
                </form>
            </div>
        </div>

        <!-- Восстановление пароля -->
        <div class="tab-content" id="recoverTab">
            <div class="form-step active" id="recoverStep1">
                <h2><i class="fas fa-key"></i> Восстановление пароля</h2>
                <form id="recoverForm">
                    <div class="form-group">
                        <label for="recoverEmail">Email:</label>
                        <input type="email" id="recoverEmail" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane"></i> Отправить код
                    </button>
                </form>
            </div>

            <div class="form-step" id="recoverStep2">
                <h2><i class="fas fa-key"></i> Смена пароля</h2>
                <p>На вашу почту отправлен код подтверждения</p>
                <form id="recoverCodeForm">
                    <div class="form-group">
                        <label for="recoverCode">Код из письма:</label>
                        <input type="text" id="recoverCode" maxlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Новый пароль:</label>
                        <div class="password-input">
                            <input type="password" id="newPassword" required>
                            <button type="button" class="toggle-password" data-target="newPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Подтвердите пароль:</label>
                        <div class="password-input">
                            <input type="password" id="confirmNewPassword" required>
                            <button type="button" class="toggle-password" data-target="confirmNewPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sync-alt"></i> Сменить пароль
                    </button>
                    <button type="button" class="btn-secondary" id="backToRecover">
                        <i class="fas fa-arrow-left"></i> Назад
                    </button>
                </form>
            </div>
        </div>

        <!-- Управление токенами -->
        <div class="tab-content" id="tokensTab">
            <h2><i class="fas fa-key"></i> Управление токенами</h2>
            <div class="token-info">
                <h3>Refresh токен</h3>
                <div class="token-display" id="refreshTokenDisplay">
                    Токен не сохранен
                </div>
                <div class="token-actions">
                    <button class="btn-secondary" id="refreshAccessToken">
                        <i class="fas fa-sync"></i> Обновить Access токен
                    </button>
                    <button class="btn-danger" id="clearTokens">
                        <i class="fas fa-trash"></i> Очистить токены
                    </button>
                </div>
                <div class="token-result" id="tokenResult"></div>
            </div>
        </div>

        <!-- Модальное окно капчи -->
        <div class="modal" id="captchaModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-robot"></i> Подтвердите, что вы не робот</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="captcha-image">
                        <img id="captchaImg" alt="Капча">
                    </div>
                    <div class="form-group">
                        <label for="captchaInput">Введите текст с картинки:</label>
                        <input type="text" id="captchaInput" required>
                    </div>
                    <div class="captcha-error" id="captchaError"></div>
                    <button class="btn-primary" id="submitCaptcha">
                        <i class="fas fa-check"></i> Подтвердить
                    </button>
                </div>
            </div>
        </div>

        <!-- Лоадер -->
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Загрузка...</p>
        </div>
    </div>
    <!-- Модальное окно предложения пин-кода -->
    <div class="modal" id="pinOfferModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-shield-alt"></i> Настройка дополнительной защиты</h2>
                <button class="close-modal" data-modal="pinOfferModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Хотите установить 4-значный пин-код для быстрого доступа?</p>
                <p class="small-text">С пин-кодом вы сможете быстро обновлять токены без повторного входа</p>
                <div class="pin-options">
                    <button class="btn-primary" id="acceptPin">
                        <i class="fas fa-check"></i> Да, установить пин-код
                    </button>
                    <button class="btn-secondary" id="declinePin">
                        <i class="fas fa-times"></i> Нет, отказаться
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно установки пин-кода -->
    <div class="modal" id="pinSetupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Установка пин-кода</h2>
                <button class="close-modal" data-modal="pinSetupModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Придумайте 4-значный пин-код (только цифры):</p>
                <div class="pin-input-container">
                    <input type="password" id="pinInput1" maxlength="1" pattern="[0-9]" class="pin-digit">
                    <input type="password" id="pinInput2" maxlength="1" pattern="[0-9]" class="pin-digit">
                    <input type="password" id="pinInput3" maxlength="1" pattern="[0-9]" class="pin-digit">
                    <input type="password" id="pinInput4" maxlength="1" pattern="[0-9]" class="pin-digit">
                </div>
                <div class="pin-error" id="pinError"></div>
                <button class="btn-primary" id="savePin">
                    <i class="fas fa-save"></i> Сохранить пин-код
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно ввода пин-кода -->
    <div class="modal" id="pinVerifyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-unlock-alt"></i> Введите пин-код</h2>
                <button class="close-modal" data-modal="pinVerifyModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Для обновления токена введите ваш 4-значный пин-код:</p>
                <div class="pin-input-container">
                    <input type="password" id="pinVerify1" maxlength="1" pattern="[0-9]" class="pin-digit">
                    <input type="password" id="pinVerify2" maxlength="1" pattern="[0-9]" class="pin-digit">
                    <input type="password" id="pinVerify3" maxlength="1" pattern="[0-9]" class="pin-digit">
                    <input type="password" id="pinVerify4" maxlength="1" pattern="[0-9]" class="pin-digit">
                </div>
                <div class="pin-error" id="pinVerifyError"></div>
                <div class="pin-options">
                    <button class="btn-primary" id="verifyPin">
                        <i class="fas fa-check"></i> Подтвердить
                    </button>
                    <button class="btn-secondary" id="cancelPin">
                        <i class="fas fa-sign-in-alt"></i> Войти заново
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно отображения токена -->
    <div class="modal" id="tokenDisplayModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> Ваш Refresh Token</h2>
                <button class="close-modal" data-modal="tokenDisplayModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Вы отказались от сохранения пин-кода. Ваш refresh token:</p>
                <div class="token-display-modal" id="tokenDisplay">
                    Токен загружается...
                </div>
                <p class="small-text">Скопируйте и сохраните этот токен в надежном месте. Он потребуется для будущих сессий.</p>
                <div class="modal-actions">
                    <button class="btn-secondary" id="copyToken">
                        <i class="fas fa-copy"></i> Копировать токен
                    </button>
                    <button class="btn-primary" id="closeTokenModal">
                        <i class="fas fa-times"></i> Закрыть
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>